{"version":3,"file":"gatsby-ssr.js","sources":["../src/on-render-body.tsx"],"sourcesContent":["import * as React from \"react\";\nimport * as gatsby from \"gatsby\";\n\nimport { PluginOptions } from \"./types\";\n\n/**\n * Returns the URL for the Prismic Toolbar script.\n *\n * @param repositoryName - Name of the repository.\n * @param type - Type of the toolbar to use.\n *\n * @returns URL for the Prismic Toolbar script.\n */\nconst getToolbarScriptURL = (\n\trepositoryName: string,\n\ttype: PluginOptions[\"toolbar\"],\n): URL => {\n\tconst url = new URL(`https://static.cdn.prismic.io/prismic.js`);\n\turl.searchParams.set(\"repo\", repositoryName);\n\n\tif (type === \"new\") {\n\t\turl.searchParams.set(\"new\", \"true\");\n\n\t\treturn url;\n\t} else {\n\t\treturn url;\n\t}\n};\n\n/**\n * Called after every page Gatsby server renders while building HTML so it can\n * set head and body components to be rendered in the app's `html.js`.\n *\n * @see https://www.gatsbyjs.com/docs/reference/config-files/gatsby-ssr#onRenderBody\n */\n// TODO: Explore what happens when multiple instances of the plugin are\n// configured. Will multiple toolbars cause conflicts?\nexport const onRenderBody: NonNullable<gatsby.GatsbySSR[\"onRenderBody\"]> =\n\tasync (\n\t\tgatsbyContext: gatsby.RenderBodyArgs,\n\t\tpluginOptions: PluginOptions,\n\t) => {\n\t\tconst toolbarScriptUrl = getToolbarScriptURL(\n\t\t\tpluginOptions.repositoryName,\n\t\t\tpluginOptions.toolbar,\n\t\t);\n\n\t\tgatsbyContext.setHeadComponents([\n\t\t\t<link\n\t\t\t\trel=\"preconnect\"\n\t\t\t\tkey=\"preconnect-prismic-toolbar\"\n\t\t\t\thref={toolbarScriptUrl.origin}\n\t\t\t/>,\n\t\t\t<link\n\t\t\t\trel=\"dns-prefetch\"\n\t\t\t\tkey=\"dns-prefetch-prismic-toolbar\"\n\t\t\t\thref={toolbarScriptUrl.origin}\n\t\t\t/>,\n\t\t]);\n\n\t\tgatsbyContext.setPostBodyComponents([\n\t\t\t<script\n\t\t\t\tsrc={toolbarScriptUrl.href}\n\t\t\t\tdefer={true}\n\t\t\t\tkey={`prismic-toolbar-${pluginOptions.repositoryName}`}\n\t\t\t/>,\n\t\t]);\n\t};\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;AAaA,MAAM,sBAAsB,CAC3B,gBACA,SACS;AACT,QAAM,MAAM,IAAI,IAAI;AACpB,MAAI,aAAa,IAAI,QAAQ;AAE7B,MAAI,SAAS,OAAO;AACnB,QAAI,aAAa,IAAI,OAAO;AAE5B,WAAO;AAAA,SACD;AACN,WAAO;AAAA;AAAA;MAYI,eACZ,OACC,eACA,kBACI;AACJ,QAAM,mBAAmB,oBACxB,cAAc,gBACd,cAAc;AAGf,gBAAc,kBAAkB;AAAA,mDAC9B,QAAD;AAAA,MACC,KAAI;AAAA,MACJ,KAAI;AAAA,MACJ,MAAM,iBAAiB;AAAA;AAAA,mDAEvB,QAAD;AAAA,MACC,KAAI;AAAA,MACJ,KAAI;AAAA,MACJ,MAAM,iBAAiB;AAAA;AAAA;AAIzB,gBAAc,sBAAsB;AAAA,mDAClC,UAAD;AAAA,MACC,KAAK,iBAAiB;AAAA,MACtB,OAAO;AAAA,MACP,KAAK,mBAAmB,cAAc;AAAA;AAAA;AAAA;;;;"}